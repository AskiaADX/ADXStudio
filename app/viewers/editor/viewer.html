<!doctype html>
<html>
<head>
    <title>Editor</title>
    <meta charset="utf-8"/>
  	<!-- CodeMirror base -->
    <link rel="stylesheet" href="../../lib/codemirror/lib/codemirror.css">
    <script src="../../lib/codemirror/lib/codemirror.js"></script>
  	<script src="../../lib/codemirror/addon/selection/active-line.js"></script>

  	<!-- Common languages modes -->
  	<script src="../../lib/codemirror/mode/xml/xml.js"></script>
    <script src="../../lib/codemirror/mode/javascript/javascript.js"></script>
    <script src="../../lib/codemirror/mode/javascript/javascript.js"></script>
    <script src="../../lib/codemirror/mode/css/css.js"></script>
    <script src="../../lib/codemirror/mode/htmlmixed/htmlmixed.js"></script>
    <script src="../../lib/codemirror/mode/markdown/markdown.js"></script>
  	<script src="../../lib/codemirror/addon/mode/multiplex.js"></script>
  	
  	<!-- AskiaScript Modes -->
  	<link rel="stylesheet" href="../../lib/codemirror/mode/askiascript/askiascript.css" />
    <script src="../../lib/codemirror/mode/askiascript/askiascript.js"></script>
    <script src="../../lib/codemirror/lexicons/AskiaLanguage-en.js"></script>
    <script src="../../lib/codemirror/lexicons/MasqueLanguage-en.js"></script>
  	<!-- AskiaSCript Embedding -->
    <script src="../../lib/codemirror/mode/askiascripthtml/askiascripthtml.js"></script>
    <script src="../../lib/codemirror/mode/askiascriptxml/askiascriptxml.js"></script>
    <script src="../../lib/codemirror/mode/askiascriptjs/askiascriptjs.js"></script>
    <script src="../../lib/codemirror/mode/askiascriptcss/askiascriptcss.js"></script>
     	
    <!-- Find and replace -->
    <link rel="stylesheet" href="../../lib/codemirror/addon/find/find.css" />
    <script src="../../lib/codemirror/addon/find/find.js"></script>
    
    <!-- Code folding -->
    <link rel="stylesheet" href="../../lib/codemirror/addon/fold/foldgutter.css" />
	<script src="../../lib/codemirror/addon/fold/foldcode.js"></script>
  	<script src="../../lib/codemirror/addon/fold/foldgutter.js"></script>
  	<script src="../../lib/codemirror/addon/fold/brace-fold.js"></script>
  	<script src="../../lib/codemirror/addon/fold/xml-fold.js"></script>
  	<script src="../../lib/codemirror/addon/fold/markdown-fold.js"></script>
  	<script src="../../lib/codemirror/addon/fold/comment-fold.js"></script>
    
  	<!-- Linters -->
  	<link rel="stylesheet" href="../../lib/codemirror/addon/lint/lint.css">
    <script src="../../lib/linters/eslint.js"></script>
    <script src="../../lib/linters/csslint.js"></script>
    <script src="../../lib/codemirror/addon/lint/lint.js"></script>
    <script src="../../lib/codemirror-lint-eslint/eslint-lint.js"></script>
    <!-- script src="../../lib/codemirror/addon/lint/css-lint.js"></script--> 
  	
  	<!-- Sense  -->
  	<link rel="stylesheet" href="../../lib/codemirror/addon/sense/sense.css" />
  	<script src="../../lib/codemirror/addon/sense/sense.js"></script>
  
  	<!-- Theme & Global management -->
	<link rel="stylesheet" href="../../themes/default/askia.css">
    <script src="../viewer.js"></script>
    <style>
        html, body
        {
            margin  : 0;
            padding : 0;
            height  : 100vh;
            overflow: hidden;
        }
        .CodeMirror {
            height      : 100vh;
        }
    </style>
</head>
<body>
    <textarea id="code" name="code"></textarea>
    <script>
        (function () {
            // Add the reference to the linter
            window.eslint = window.parent.eslint;

            var contentTypeByFileExt = {
                html : 'askiascript/html',
                htm  : 'askiascript/html',
                js   : 'askiascript/javascript',
                css  : 'askiascript/css',
                xml  : 'askiascript/xml',
                md   : 'text/x-markdown'
            };
            var tabs     = viewer.tabs;
            var tab      = viewer.currentTab;
            var textarea = document.getElementById('code');

            var matchFileExt = /\.([^\.]+)$/.exec(tab.name);
            var contentType = (matchFileExt && matchFileExt.length) ?
                    contentTypeByFileExt[matchFileExt[1].toLocaleLowerCase()] : '';

            textarea.value = tab.content;

            // Map save command (CTRL+S) and the main menu
            viewer.saveContent = CodeMirror.commands.save = function () {
                tabs.onSave(tab.id, window.editor.getValue());
            };

            // Save as
            viewer.saveContentAs = function saveContentAs() {
                tabs.onSaveAs(tab.id, window.editor.getValue());
            };

            // Save & Close
            viewer.saveContentAndClose = function saveContentAndClose() {
                tabs.onSaveAndClose(tab.id, window.editor.getValue());
            };

            tab.editor = window.editor = CodeMirror.fromTextArea(textarea, {
                lineNumbers     : true,
              	indentUnit		: 4,
                gutters         : ["CodeMirror-lint-markers", "CodeMirror-foldgutter", "CodeMirror-linenumbers"],
                mode            : contentType,
                theme           : 'askia',
                styleActiveLine	: true,
              	extraKeys		: {
					"Ctrl--"	: CodeMirror.commands.fold,
                  	"Ctrl-="	: CodeMirror.commands.unfold,
                  	"Shift-Ctrl--"	: CodeMirror.commands.foldAll,
                  	"Shift-Ctrl-="	: CodeMirror.commands.unfoldAll
                },
          		foldGutter		: true,
                lint			: true,
                questions       : []
            }).suggest();

            window.editor.on('change', function onChange(instance) {
                tabs.onContentChange(tab.id, instance.getValue());
            });

            viewer.fireReady();
        }());

    </script>
</body>
</html>
