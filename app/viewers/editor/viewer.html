<!doctype html>
<html>
<head>
    <title>Editor</title>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="../../lib/codemirror/lib/codemirror.css">
    <script src="../../lib/codemirror/lib/codemirror.js"></script>
    <link rel="stylesheet" href="../../lib/codemirror/mode/askiascript/askiascript.css" />
    <script src="../../lib/codemirror/mode/askiascript/askiascript.js"></script>
    <script src="../../lib/codemirror/lexicons/AskiaLanguage-en.js"></script>
    <script src="../../lib/codemirror/lexicons/MasqueLanguage-en.js"></script>
    <script src="../../lib/codemirror/mode/xml/xml.js"></script>
    <script src="../../lib/codemirror/mode/javascript/javascript.js"></script>
    <script src="../../lib/codemirror/mode/javascript/javascript.js"></script>
    <script src="../../lib/codemirror/mode/css/css.js"></script>
    <script src="../../lib/codemirror/mode/htmlmixed/htmlmixed.js"></script>
    <script src="../../lib/codemirror/mode/markdown/markdown.js"></script>
    <script src="../../lib/codemirror/addon/mode/multiplex.js"></script>
    <script src="../../lib/codemirror/mode/askiascripthtml/askiascripthtml.js"></script>
    <script src="../../lib/codemirror/mode/askiascriptxml/askiascriptxml.js"></script>
    <script src="../../lib/codemirror/mode/askiascriptjs/askiascriptjs.js"></script>
    <script src="../../lib/codemirror/mode/askiascriptcss/askiascriptcss.js"></script>
    <link rel="stylesheet" href="../../lib/codemirror/addon/sense/sense.css" />
  	<script src="../../lib/codemirror/addon/selection/active-line.js"></script>
    <script src="../../lib/codemirror/addon/sense/sense.js"></script>
    <link rel="stylesheet" href="../../lib/codemirror/addon/fold/foldgutter.css" />
	<script src="../../lib/codemirror/addon/fold/foldcode.js"></script>
  	<script src="../../lib/codemirror/addon/fold/foldgutter.js"></script>
  	<script src="../../lib/codemirror/addon/fold/brace-fold.js"></script>
  	<script src="../../lib/codemirror/addon/fold/xml-fold.js"></script>
  	<script src="../../lib/codemirror/addon/fold/markdown-fold.js"></script>
  	<script src="../../lib/codemirror/addon/fold/comment-fold.js"></script>
	<link rel="stylesheet" href="../../themes/default/askia.css">
    <script src="../viewer.js"></script>
    <style>
        html, body
        {
            margin  : 0;
            padding : 0;
            height  : 100vh;
            overflow: hidden;
        }
        .CodeMirror {
            height      : 100vh;
        }
    </style>
</head>
<body>
    <textarea id="code" name="code"></textarea>
    <script>
        (function () {
            var contentTypeByFileExt = {
                html : 'askiascript/html',
                htm  : 'askiascript/html',
                js   : 'askiascript/javascript',
                css  : 'askiascript/css',
                xml  : 'askiascript/xml',
                md   : 'text/x-markdown'
            };
            var tabs     = viewer.tabs;
            var tab      = viewer.currentTab;
            var textarea = document.getElementById('code');

            var matchFileExt = /\.(.*?)$/.exec(tab.name);
            var contentType = (matchFileExt && matchFileExt.length) ?
                    contentTypeByFileExt[matchFileExt[1].toLocaleLowerCase()] : '';

            textarea.value = tab.content;

            // Map save command
            CodeMirror.commands.save = function (instance) {
                tabs.onSave(tab.id, instance.getValue());
            };

            tab.editor = window.editor = CodeMirror.fromTextArea(textarea, {
                lineNumbers     : true,
                gutters         : ["cms-gutter-errors", "CodeMirror-foldgutter", "CodeMirror-linenumbers"],
                mode            : contentType,
                theme           : 'askia',
                styleActiveLine	: true,
              	extraKeys		: {
					"Ctrl--"	: CodeMirror.commands.fold,
                  	"Ctrl-="	: CodeMirror.commands.unfold,
                  	"Shift-Ctrl--"	: CodeMirror.commands.foldAll,
                  	"Shift-Ctrl-="	: CodeMirror.commands.unfoldAll
                },
          		foldGutter		: true,
                questions       : []
            }).suggest();

            window.editor.on('change', function onChange(instance) {
                tabs.onContentChange(tab.id, instance.getValue());
            });


            viewer.fireReady();
        }());

    </script>
</body>
</html>
