<!DOCTYPE html>
<html>
  <head>
    <title>Hello World!</title>
    <link rel="stylesheet" type="text/css" href="explorer.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="../theme.css"/>
    <style>
    .toggle, .icon {

        width: 20px;
        height: 20px;
    }
    .icon {
      margin-left:3px;
    }

    .item-info div {
      display: inline-block;
    }

    .child {
      display: none;
    }

    </style>
  </head>
  <body>
    <div id="root">
      <div class="child" style="display: block;">
      </div>
    </div>

    <script type="text/javascript">
    // the object map is created to give unique id to each item
    var map = {
      autoincrement: 0
    };

    var ipc = require('ipc');

    function itemclick(itemInfo) {

      var item = itemInfo.parentNode;
      var file = map[item.id];
      var child = item.querySelector('.child');
      var toggle;

      // Folder system
      if (file.type === 'folder') {
        toggle = itemInfo.querySelector('.toggle');

        if(child.style.display === 'block') {
          //if it's open, then we close it on click
          child.style.display = '';
          toggle.classList.remove('open');
        } else {
          // if it's close we open it on click
          child.style.display = 'block';
          toggle.classList.add('open');
        }

        if(!file.loaded) {
          ipc.send('explorer-loadfolder', file.path, item.id);
          file.loaded = true;
        }
      } else {
        ipc.send('explorer-loadfile', file);
        item.classList.add('backgclick');
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      ipc.on('loadFolder', function( err, files, elementid) {
        var root = document.getElementById(elementid).querySelector('.child');
        root.innerHTML = '';

        for (var i = 0; i < files.length; i += 1) {

          map.autoincrement++;
          map['item'+ map.autoincrement] = files[i];

          var item = document.createElement('div');
          item.className = files[i].type;
          item.id = 'item'+ map.autoincrement;

          var itemInfo = document.createElement('div');
          itemInfo.className = 'item-info';
          //The function when someone click on a div itemInfo
          itemInfo.onclick = function() {
            itemclick(this);
          };


          var toggle = document.createElement('div');
          toggle.className = 'toggle';
          itemInfo.appendChild(toggle);

          var icon = document.createElement('div');
          icon.className = 'icon';
          itemInfo.appendChild(icon);

          var name = document.createElement('div');
          name.className = 'name';
          name.innerHTML = files[i].name;
          itemInfo.appendChild(name);

          item.appendChild(itemInfo);

          if(files[i].type == 'folder') {
            var child = document.createElement('div');
            child.className="child";
            item.appendChild(child);
          }
            root.appendChild(item);
        }
    });
      ipc.send('explorer-ready');
  });
    </script>

  </body>
</html>
